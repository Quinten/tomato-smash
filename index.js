!function(t){var e={};function i(s){if(e[s])return e[s].exports;var h=e[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(s,h,function(e){return t[e]}.bind(null,h));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){},function(t,e,i){"use strict";i.r(e);i(0);var s=class{constructor(){this.listeners={}}on(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}once(t,e){let i=s=>{e(s),this.off(t,i)};this.on(t,i)}off(t,e){t||(this.listeners={}),this.listeners[t]&&(e||(this.listeners[t]=[]),this.listeners[t].splice(this.listeners[t].indexOf(e),1))}emit(t,e){this.listeners[t]&&this.listeners[t].forEach(t=>{t(e)})}};var h=class{constructor(){this.events=new s,this.cache={},this.queueLength=0,this.progress=0,this.queueMax=0}load(t){t.length&&(this.progress=0,t.forEach(t=>{if(!this.cache[t.name])switch(this.queueLength++,t.type){case"image":this.loadImage(t)}}),this.queueMax=this.queueLength)}loadImage(t){let e=new Image;e.onload=i=>{this.cache[t.name]=e,this.queueLength--,this.progress=1-this.queueLength/this.queueMax,0===this.queueLength&&this.events.emit("queuedone")},e.src=t.src}getByName(t){if(this.cache[t])return this.cache[t]}};var o=class{constructor({x:t=0,y:e=0}={}){this.x=t,this.y=e,this.viewport={width:320,height:180,zoom:1},this.followTarget=void 0,this.lerpX=1,this.lerpY=1,this.bounds=void 0,this.shakeTimer=0,this.shakeIntensity=.02,this.events=new s,this.fadeTimer=0,this.fadeDuration=0,this.fadeColor="#000000",this.flashTimer=0,this.flashDuration=0,this.flashColor="#000000"}getOffset(t,e){this.followTarget&&(this.x+=(this.followTarget.x-this.x)*this.lerpX,this.y+=(this.followTarget.y-this.y)*this.lerpY);let i=this.viewport.width/2,s=this.viewport.height/2;this.bounds&&(this.x=Math.max(this.x,this.bounds.x+i),this.x=Math.min(this.x,this.bounds.x+this.bounds.width-i),this.y=Math.max(this.y,this.bounds.y+s),this.y=Math.min(this.y,this.bounds.y+this.bounds.height-s));let h=this.x-i,o=this.y-s;return this.shakeTimer>0&&(this.shakeTimer-=e,h+=this.viewport.width*(1-2*Math.random())*this.shakeIntensity,o+=this.viewport.height*(1-2*Math.random())*this.shakeIntensity),{x:h,y:o}}postRender(t,e,i){this.fadeTimer>0&&(this.fadeTimer-=i,t.save(),t.globalAlpha=Math.min(1,1-this.fadeTimer/this.fadeDuration),t.fillStyle=this.fadeColor,t.fillRect(0,0,this.viewport.width,this.viewport.height),t.restore(),this.fadeTimer<=0&&this.events.emit("fadecomplete")),this.flashTimer>0&&(t.save(),t.globalAlpha=Math.max(0,this.flashTimer/this.flashDuration),t.fillStyle=this.flashColor,t.fillRect(0,0,this.viewport.width,this.viewport.height),t.restore(),this.flashTimer-=i,this.flashTimer<=0&&this.events.emit("flashcomplete"))}setBounds(t,e,i,s){this.bounds={x:t,y:e,width:i,height:s}}shake({duration:t=300,intensity:e=.02}={}){this.shakeTimer=t,this.shakeIntensity=e}fade({duration:t=750,color:e="#000000"}={}){this.fadeTimer=t,this.fadeDuration=t,this.fadeColor=e}flash({duration:t=750,color:e="#000000"}={}){this.flashTimer=t,this.flashDuration=t,this.flashColor=e}};var r=class{constructor(){this.active=!1,this.viewport={width:320,height:180,zoom:1},this.camera=new o,this.engine=void 0,this.world=void 0}setup(){this.camera.x=this.viewport.width/2,this.camera.y=this.viewport.height/2,this.children=[],this.controls=[],this.init(),this.active=!0}addWorld(t){return this.world=t,this.world}addControls(t){return t.scene=this,this.controls.push(t),t.init(),t}add(t){return t.scene=this,this.children.push(t),t}remove(t){this.world&&t.body&&this.world.removeBody(t.body),t.destroy(),t.scene=void 0,this.children.splice(this.children.indexOf(t),1)}init(){}update(t,e){}resize(t,e){}render(t,e,i){this.world&&this.world.step(i);let s=this.camera.getOffset(e,i);this.children.forEach(e=>{e.body&&(e.x=e.body.midX+e.offsetX,e.y=e.body.midY+e.offsetY),e.x-e.width/2+e.width<s.x*e.scrollFactorX||e.x-e.width/2>s.x*e.scrollFactorX+this.viewport.width||e.y-e.height/2+e.height<s.y*e.scrollFactorY||e.y-e.height/2>s.y*e.scrollFactorY+this.viewport.height||e.render(t,s)}),this.camera.postRender(t,e,i)}shutdown(){this.children.forEach(t=>{t.destroy(),t.scene=void 0}),this.children=[],this.controls.forEach(t=>{t.destroy(),t.scene=void 0}),this.controls=[],this.camera.events.off(),this.active=!1,this.world&&(this.world.destroy(),this.world=void 0)}};var n=class{constructor({x:t=0,y:e=0}={}){this.x=t,this.y=e,this.scrollFactorX=1,this.scrollFactorY=1,this.width=32,this.height=32,this.fillStyle="#00FF00",this.scene=void 0,this.visible=!0,this.body=void 0,this.offsetX=0,this.offsetY=0}addBody(t){return t.width=this.width,t.height=this.height,t.x=this.x-t.halfWidth,t.y=this.y-t.halfHeight,this.scene.world&&this.scene.world.addBody(t),this.body=t,this.body}render(t,e){this.visible&&(t.save(),t.translate(Math.round(this.x-e.x*this.scrollFactorX),Math.round(this.y-e.y*this.scrollFactorY)),this.draw(t),t.restore())}draw(t){t.fillStyle=this.fillStyle,t.fillRect(-this.width/2,-this.height/2,this.width,this.height)}destroy(){this.body=void 0}};var a=class extends n{constructor({x:t=0,y:e=0}={}){super({x:t,y:e}),this.width=128,this.height=32,this.progress=0}draw(t){t.strokeStyle=this.fillStyle,t.lineWidth=2,t.strokeRect(-this.width/2,-this.height/2,this.width,this.height),t.fillStyle=this.fillStyle,t.fillRect(-this.width/2+4,-this.height/2+4,Math.floor((this.width-8)*this.progress),this.height-8)}};var l=class extends r{init(){this.engine.assets.events.once("queuedone",()=>{this.options.nextScene&&this.engine.switchScene(this.options.nextScene)}),this.engine.assets.load(this.options.assets),this.bar=new a({x:this.viewport.width/2,y:this.viewport.height/2}),this.bar.fillStyle=this.engine.foreground,this.add(this.bar)}update(t,e){this.bar.progress=this.engine.assets.progress}shutdown(){super.shutdown(),this.bar=void 0}};var d=class{constructor(t,e,i,s,o){if(this.canvas=e,this.context=e.getContext("2d"),this.scenes=[],t.forEach(t=>{let e=new t.class;e.name=t.name,t.options&&(e.options=t.options),e.engine=this,this.scenes.push(e)}),this.time=0,this.delta=17,this.background=i,this.foreground=s,this.assets=new h,o){this.startAssets=o;let t=new l;t.name="verfdefaultpreloader",t.options={assets:this.startAssets,nextScene:this.scenes[0]?this.scenes[0].name:void 0},t.engine=this,this.scenes.unshift(t)}this.timeouts=[]}start(){this.scenes[0]&&this.scenes[0].setup(),window.requestAnimationFrame(this.onFrame.bind(this))}onFrame(t){let e=t-this.time;this.time=t,e>200&&(e=200),this.delta=e;for(let t=this.timeouts.length-1;t>=0;t--)this.timeouts[t].end<=this.time&&(this.timeouts[t].callback(),this.clearTimeout(this.timeouts[t]));"transparent"==this.background?this.context.clearRect(0,0,this.canvas.width,this.canvas.height):(this.context.save(),this.context.fillStyle=this.background,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.restore()),this.scenes.forEach(i=>{i.active&&i.update(t,e)}),this.scenes.forEach(i=>{i.active&&i.render(this.context,t,e)}),window.requestAnimationFrame(this.onFrame.bind(this))}switchScene(t){this.scenes.forEach(e=>{if(e.name==t){if(e.active)return;e.setup()}else e.active&&e.shutdown()})}setTimeout(t,e){let i={callback:t,end:this.time+e};return this.timeouts.push(i),i}clearTimeout(t){this.timeouts.splice(this.timeouts.indexOf(t),1)}};var c=class{constructor({parent:t="body",width:e=320,height:i=180,resizable:s=!0,zoom:h="auto",pixelArt:o=!0,scenes:r=[],background:n="transparent",foreground:a="#000000",assets:l}={}){this.parent=document.querySelector(t),this.canvas=document.createElement("canvas"),o&&(this.canvas.style.imageRendering="pixelated"),this.canvas.style.display="block",this.parent.appendChild(this.canvas),this.engine=new d(r,this.canvas,n,a,l),this.zoom=h,s?("auto"==h&&(e&&(this.targetWidth=e),i&&(this.targetHeight=i)),this.resizeTOID=0,window.addEventListener("resize",()=>{clearTimeout(this.resizeTOID),this.resizeTOID=setTimeout(this.onWindowResize.bind(this),500)}),this.onWindowResize(),document.body.style.margin="0",document.body.style.overflow="hidden"):("auto"==this.zoom&&(this.zoom=1),this.setSize(e,i,this.zoom)),this.engine.start()}onWindowResize(){let t=this.zoom;if("auto"==t){let e=Math.max(1,Math.floor(window.innerWidth/(this.targetWidth?this.targetWidth:window.innerWidth))),i=Math.max(1,Math.floor(window.innerHeight/(this.targetHeight?this.targetHeight:window.innerHeight)));t=Math.min(e,i)}let e=Math.ceil(window.innerWidth/t),i=Math.ceil(window.innerHeight/t);this.setSize(e,i,t)}setSize(t,e,i){this.canvas.width=t,this.canvas.height=e,this.canvas.style.width=t*i+"px",this.canvas.style.height=e*i+"px",this.engine.scenes.forEach(s=>{s.viewport.width=t,s.viewport.height=e,s.viewport.zoom=i,s.camera.viewport.width=t,s.camera.viewport.height=e,s.camera.viewport.zoom=i,s.active&&s.resize(t,e)})}};new c({width:640,height:480,zoom:1,resizable:!1,background:"tomato"})}]);